---
title: "Day 1: Generalized Linear Mixed Models"
output:
  html_document: default
  html_notebook: default
---
Read in the individual data (or a pairwise dataset) 

```{r}
library(tidyr)
library(dplyr)

#install.packages("glmm")
library(glmm)

acitelli_ind <- read.csv(file.choose(), header=TRUE)

library(mosaic)
```

Convert individual data to pairwise. I also create a simhobs variable that will be our binary response. 

```{r}
tempA <- acitelli_ind %>% 
  mutate(genderE = gender, partnum = 1) %>%
  mutate(gender = ifelse(gender == 1, "A", "P")) %>%
  gather(variable, value, self_pos:genderE) %>%
  unite(var_gender, variable, gender) %>%
  spread(var_gender, value)

tempB <- acitelli_ind %>% 
  mutate(genderE = gender, partnum = 2) %>%
  mutate(gender = ifelse(gender == 1, "P", "A")) %>%
  gather(variable, value, self_pos:genderE)%>%
  unite(var_gender, variable, gender) %>%
  spread(var_gender, value)

acitelli_pair <- bind_rows(tempA, tempB) %>%
  arrange(cuplid) %>%
  mutate(gender_A = ifelse(genderE_A == 1, "hus", "wife"), 
         gender_A = as.factor(gender_A),
         simhob_bin_A = ifelse(simhob_A == 1, 1, 0)) 
  
rm(tempA, tempB)
```


```{r}
data(salamander)

set.seed(1234)

sal <- glmm(Mate ~ 0 + Cross, 
            random = list(~ 0 + Female, ~ 0 + Male), 
            varcomps.names = c("F", "M"), 
            data = salamander,
            family.glmm = bernoulli.glmm, 
            m = 10^4)

summary(sal)

#doesn't run
apim_bin <- glmm(simhob_bin_A ~ 1, 
            random = list(~ 0 + cuplid),
            varcomps.names = c("couple"),
            data = acitelli_pair,
            family.glmm = bernoulli.glmm, 
            m = 10^4)

summary(apim_bin)

```








